<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event and epoch handling • eegUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Event and epoch handling">
<meta property="og:description" content="eegUtils">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eegUtils</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/eegUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_structures.html">A guide to eegUtils data structures</a>
    </li>
    <li>
      <a href="../articles/epoch-handling.html">Event and epoch handling</a>
    </li>
    <li>
      <a href="../articles/linear_modelling/linear_modelling.html">Linear Modelling</a>
    </li>
    <li>
      <a href="../articles/time-frequency-analysis.html">Frequency analysis</a>
    </li>
    <li>
      <a href="../articles/topoplot/topoplot.html">Building a topographical plot</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/craddm/eegUtils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="epoch-handling_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Event and epoch handling</h1>
                        <h4 class="author">Matt Craddock</h4>
            
            <h4 class="date">2021-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/craddm/eegUtils/blob/master/vignettes/epoch-handling.Rmd"><code>vignettes/epoch-handling.Rmd</code></a></small>
      <div class="hidden name"><code>epoch-handling.Rmd</code></div>

    </div>

    
    
<pre><code>#&gt; EEG data
#&gt; 
#&gt; Number of channels   : 72 
#&gt; Electrode names      : A1 A2 A3 A4 A5 A6 A7 A8 A9 A10 A11 A12 A13 A14 A15 A16 A17 A18 A19 A20 A21 A22 A23 A24 A25 A26 A27 A28 A29 A30 A31 A32 B1 B2 B3 B4 B5 B6 B7 B8 B9 B10 B11 B12 B13 B14 B15 B16 B17 B18 B19 B20 B21 B22 B23 B24 B25 B26 B27 B28 B29 B30 B31 B32 EXG1 EXG2 EXG3 EXG4 EXG5 EXG6 EXG7 EXG8 
#&gt; Sampling rate        : 512 Hz
#&gt; Reference        :</code></pre>
<p>In this example, we’re going to look at how to handle epoching and events. To start, we have continuous data from 70 channels sampled at 512 Hz, average referenced, and bandpass filtered from 0.1 to 40 Hz. There is a complete table of all of the events imported with the data. We can use that table to form epochs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eeg_example</span>
<span class="co">#&gt; EEG data</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of channels   : 70 </span>
<span class="co">#&gt; Electrode names      : A1 A2 A3 A4 A5 A6 A7 A8 A9 A10 A11 A12 A13 A14 A15 A16 A17 A18 A19 A20 A21 A22 A23 A24 A25 A26 A27 A28 A29 A30 A31 A32 B1 B2 B3 B4 B5 B6 B7 B8 B9 B10 B11 B12 B13 B14 B15 B16 B17 B18 B19 B20 B21 B22 B23 B24 B25 B26 B27 B28 B29 B30 B31 B32 EXG1 EXG2 EXG3 EXG4 EXG5 EXG6 </span>
<span class="co">#&gt; Sampling rate        : 512 Hz</span>
<span class="co">#&gt; Reference        : average</span>
<span class="fu"><a href="../reference/events.html">events</a></span><span class="op">(</span><span class="va">eeg_example</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 468 x 3</span>
<span class="co">#&gt;    event_onset event_time event_type</span>
<span class="co">#&gt;          &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1         475      0.926         18</span>
<span class="co">#&gt;  2         737      1.44         123</span>
<span class="co">#&gt;  3        1252      2.44         125</span>
<span class="co">#&gt;  4        1674      3.27         219</span>
<span class="co">#&gt;  5        2066      4.03         202</span>
<span class="co">#&gt;  6        2681      5.23          50</span>
<span class="co">#&gt;  7        3470      6.78           7</span>
<span class="co">#&gt;  8        3731      7.29         123</span>
<span class="co">#&gt;  9        4246      8.29         125</span>
<span class="co">#&gt; 10        4668      9.12         208</span>
<span class="co">#&gt; # ... with 458 more rows</span></code></pre></div>
<p>There are 18 unique trigger codes, which we can check with <code><a href="../reference/list_events.html">list_events()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/list_events.html">list_events</a></span><span class="op">(</span><span class="va">eeg_example</span><span class="op">)</span>
<span class="co">#&gt;    event_type</span>
<span class="co">#&gt; 1          18</span>
<span class="co">#&gt; 2         123</span>
<span class="co">#&gt; 3         125</span>
<span class="co">#&gt; 4         219</span>
<span class="co">#&gt; 5         202</span>
<span class="co">#&gt; 6          50</span>
<span class="co">#&gt; 7           7</span>
<span class="co">#&gt; 8         208</span>
<span class="co">#&gt; 9          51</span>
<span class="co">#&gt; 10         21</span>
<span class="co">#&gt; 11        222</span>
<span class="co">#&gt; 12         12</span>
<span class="co">#&gt; 13        213</span>
<span class="co">#&gt; 14          6</span>
<span class="co">#&gt; 15        207</span>
<span class="co">#&gt; 16         14</span>
<span class="co">#&gt; 17        215</span>
<span class="co">#&gt; 18         99</span></code></pre></div>
<p>In this experiment, six of those triggers correspond to condition codes.</p>
<table class="table">
<thead><tr class="header">
<th>Trigger</th>
<th>Semantic type</th>
<th>Spatial frequency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>207</td>
<td>Match</td>
<td>High</td>
</tr>
<tr class="even">
<td>208</td>
<td>Match</td>
<td>Low</td>
</tr>
<tr class="odd">
<td>213</td>
<td>Mismatch</td>
<td>High</td>
</tr>
<tr class="even">
<td>215</td>
<td>Mismatch</td>
<td>Low</td>
</tr>
<tr class="odd">
<td>219</td>
<td>Nonsense</td>
<td>High</td>
</tr>
<tr class="even">
<td>222</td>
<td>Nonsense</td>
<td>Low</td>
</tr>
</tbody>
</table>
<p>We can use the <code><a href="../reference/epoch_data.html">epoch_data()</a></code> function to create epochs around each of these triggers, and label those epochs accordingly. In this example, I’ll label each trigger using hierarchically coded event tags, simultaneously giving each condition of semantic type and spatial frequency separated by a “/” symbol.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_epochs</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/epoch_data.html">epoch_data</a></span><span class="op">(</span><span class="va">eeg_example</span>,
             events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">207</span>, 
                        <span class="fl">208</span>,
                        <span class="fl">213</span>,
                        <span class="fl">215</span>,
                        <span class="fl">219</span>,
                        <span class="fl">222</span><span class="op">)</span>,
             epoch_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Match/HSF"</span>,
                              <span class="st">"Match/LSF"</span>,
                              <span class="st">"Mismatch/HSF"</span>,
                              <span class="st">"Mismatch/LSF"</span>,
                              <span class="st">"Nonsense/HSF"</span>,
                              <span class="st">"Nonsense/LSF"</span><span class="op">)</span>,
             time_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.2</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; The current default value of baseline, NULL,</span>
<span class="co">#&gt;             will change to 'none' in v0.6 of eegUtils,</span>
<span class="co">#&gt;             performing no baseline correction.</span>
<span class="co">#&gt; Adjusting output limits to match sampling rate.</span>
<span class="co">#&gt; Output limits:  -0.19921875 0.599609375</span>
<span class="co">#&gt; Removing channel means per epoch...</span>
<span class="co">#&gt; Creating 78 epochs.</span>
<span class="fu"><a href="../reference/events.html">events</a></span><span class="op">(</span><span class="va">example_epochs</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 78 x 6</span>
<span class="co">#&gt;    event_onset event_time event_type event_label  epoch  time</span>
<span class="co">#&gt;          &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1674       3.27        219 Nonsense/HSF     1     0</span>
<span class="co">#&gt;  2        4668       9.12        208 Match/LSF        2     0</span>
<span class="co">#&gt;  3        7565      14.8         222 Nonsense/LSF     3     0</span>
<span class="co">#&gt;  4       10613      20.7         208 Match/LSF        4     0</span>
<span class="co">#&gt;  5       13486      26.3         213 Mismatch/HSF     5     0</span>
<span class="co">#&gt;  6       16263      31.8         207 Match/HSF        6     0</span>
<span class="co">#&gt;  7       19293      37.7         215 Mismatch/LSF     7     0</span>
<span class="co">#&gt;  8       22069      43.1         208 Match/LSF        8     0</span>
<span class="co">#&gt;  9       25063      48.9         222 Nonsense/LSF     9     0</span>
<span class="co">#&gt; 10       27912      54.5         213 Mismatch/HSF    10     0</span>
<span class="co">#&gt; # ... with 68 more rows</span>
<span class="fu"><a href="../reference/epochs.html">epochs</a></span><span class="op">(</span><span class="va">example_epochs</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 78 x 5</span>
<span class="co">#&gt;    epoch participant_id recording event_type epoch_labels</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;       </span>
<span class="co">#&gt;  1     1 S2             S2B1             219 Nonsense/HSF</span>
<span class="co">#&gt;  2     2 S2             S2B1             208 Match/LSF   </span>
<span class="co">#&gt;  3     3 S2             S2B1             222 Nonsense/LSF</span>
<span class="co">#&gt;  4     4 S2             S2B1             208 Match/LSF   </span>
<span class="co">#&gt;  5     5 S2             S2B1             213 Mismatch/HSF</span>
<span class="co">#&gt;  6     6 S2             S2B1             207 Match/HSF   </span>
<span class="co">#&gt;  7     7 S2             S2B1             215 Mismatch/LSF</span>
<span class="co">#&gt;  8     8 S2             S2B1             208 Match/LSF   </span>
<span class="co">#&gt;  9     9 S2             S2B1             222 Nonsense/LSF</span>
<span class="co">#&gt; 10    10 S2             S2B1             213 Mismatch/HSF</span>
<span class="co">#&gt; # ... with 68 more rows</span></code></pre></div>
<p>As can be seen, this modifies the epochs structure so that it now labels each epoch accordingly. Since we have hierarchically encoded event tags, an easy way to split that into multiple columns is using the <code>separate()</code> function from the <code>tidyr</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/epochs.html">epochs</a></span><span class="op">(</span><span class="va">example_epochs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="fu"><a href="../reference/epochs.html">epochs</a></span><span class="op">(</span><span class="va">example_epochs</span><span class="op">)</span>,
                                          col <span class="op">=</span> <span class="va">epoch_labels</span>,
                                          into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Semantics"</span>, <span class="st">"SF"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/epochs.html">epochs</a></span><span class="op">(</span><span class="va">example_epochs</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 78 x 6</span>
<span class="co">#&gt;    epoch participant_id recording event_type Semantics SF   </span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;</span>
<span class="co">#&gt;  1     1 S2             S2B1             219 Nonsense  HSF  </span>
<span class="co">#&gt;  2     2 S2             S2B1             208 Match     LSF  </span>
<span class="co">#&gt;  3     3 S2             S2B1             222 Nonsense  LSF  </span>
<span class="co">#&gt;  4     4 S2             S2B1             208 Match     LSF  </span>
<span class="co">#&gt;  5     5 S2             S2B1             213 Mismatch  HSF  </span>
<span class="co">#&gt;  6     6 S2             S2B1             207 Match     HSF  </span>
<span class="co">#&gt;  7     7 S2             S2B1             215 Mismatch  LSF  </span>
<span class="co">#&gt;  8     8 S2             S2B1             208 Match     LSF  </span>
<span class="co">#&gt;  9     9 S2             S2B1             222 Nonsense  LSF  </span>
<span class="co">#&gt; 10    10 S2             S2B1             213 Mismatch  HSF  </span>
<span class="co">#&gt; # ... with 68 more rows</span></code></pre></div>
<p>Any columns in the <code>epochs</code> structure are included when converting to a data frame. This has a lot of advantages for plotting; many plotting commands now allow you to use <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> from <code>ggplot2</code> to facet on any of the columns from the epoch structure. Note that for performance reasons, facetting must be explicitly allowed using <code>allow_facets = TRUE</code>, since <code>ggplot2</code>’s <code><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary()</a></code> function can be extremely slow.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_butterfly.html">plot_butterfly</a></span><span class="op">(</span><span class="va">example_epochs</span>,
               legend <span class="op">=</span> <span class="cn">FALSE</span>,
               baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span>,
               allow_facets <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">SF</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("epoch", "participant_id", "recording", "event_type", "Semantics", "SF")</span>
<span class="co">#&gt; Joining, by = c("epoch", "participant_id", "recording", "event_type", "Semantics", "SF")</span></code></pre></div>
<p><img src="epoch-handling_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Craddock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
